<html> 
 <head>
  <script type="text/javascript" src="analyzerlib.js"></script>
<style type="text/css" media="screen">
    .editor { 
        height: 400px;
    }
</style>
 </head>
 <body>
  <button onclick="loadDoc1()">Load</button>
  <button onclick="ms_parse()">Parse</button>
  <button onclick="ms_normalize()">Normalize</button>
  <button onclick="ms_get_bounds()">Compute stack bounds</button>
  <button onclick="ms_type_of()">Infer types</button>
  <button onclick="ms_cost(true);editor_out.selectAll()">Compute max gain</button>
  <button onclick="ms_cost(false);editor_out.selectAll()">Compute max loss</button>
  <button onclick="ms_cofloco()">Call Cofloco</button>
  <button onclick="ms_copy_output_to_input()">&lt; Copy output to input</button>
  <hr>
  <table width="100%">
  <tr>
  <td>
<div id="in" class="editor">
contract User1 {
    function main() {
        Ponzi.init();
    }
    
    function go() {
        Ponzi.join.value(110)();
    }
}

contract User2 {

    function go() {
        Ponzi.join.value(110)();
    }
    
}

contract User3 {

    function go() {
        Ponzi.join.value(110)();
    }
    
}

(*contract User4 {

    function go() {
        Ponzi.join.value(110)();
    }
    
}*)

contract Ponzi {
    address owner1;
    address owner2;
    address owner3;
    (*address owner4;*)
    (*address owner5;*)
    int first;
    int last;
    
    function init() {
        owner1 = Ponzi;
        owner2 = Ponzi;
        owner3 = Ponzi;
        (*owner4 = Ponzi;*)
        (*owner5 = Ponzi;*)
        first = 1;
        last = 1;
        
        User1.go();
    }
    
    function push(address addr) {
        if      (last == 1) owner1 = addr;
        else if (last == 2) owner2 = addr;
        else if (last == 3) owner3 = addr;
        (*else if (last == 4) owner4 = addr;*)
        (*else if (last == 5) owner5 = addr;*)
        else revert();
        last = last + 1;
        
        if (this.balance >= 150) pop();
    }
    
    function pop() {
        address res;
        if (first >= last) return;
        if      (first == 1) res = owner1;
        else{if (first == 2) res = owner2;
        else if (first == 3) res = owner3;
        (*else if (first == 4) res = owner4;*)
        (*else if (first == 5) res = owner5;*)
        else revert(); }
        first = first + 1;
        
        res.transfer(150);
    }
    
    function join() payable {
        if (msg.value != 110) revert() ;
        Bank.transfer(10);
        push(msg.sender);
    }
}

contract Bank {
    
}
</div>
  </td>
  <td width="50%">
  <div id="out" class="editor"></div>
  </td>
  </tr>
  <tr>
  <td>
  </td>
  </tr>
  </table>
 <div id="errors"></div>
    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor_in = ace.edit("in");
    var editor_out = ace.edit("out");
    editor_out.setReadOnly(true);
    //editor_in.setTheme("ace/theme/tomorrow");
    editor_in.setTheme("ace/theme/tomorrow_night_blue");
    editor_out.setTheme("ace/theme/tomorrow_night_blue");
    editor_in.session.setMode("ace/mode/microsolidity");
    editor_out.session.setMode("ace/mode/microsolidity");
    doc_in = editor_in.getSession().getDocument();
    doc_out = editor_out.getSession().getDocument();
    loadDoc1();

function loadDoc(filename) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      doc_in.setValue(this.responseText);
    }
  };
  xhttp.open("GET", filename, true);
  xhttp.send();
}

function loadDoc1() {
  loadDoc("demo/demo1.sol");
}

function ms_cofloco() {
    $.ajax({
        type: "POST",
        dataType: "JSON",
        url: "http://sra.cs.unibo.it/cofloco.php",
        data: {
            input_code: editor_in.getValue(),
            options: "-v 0"//$(this).attr('data')
        },
        cache: false,
        success: function (json) {
            if (json.status == 'success') {
                //cost result
                $.ajax({
                    url: "http://sra.cs.unibo.it/file_get.php",
                    //data: "file_path=" + json.result+"options=",
                    data: {'file_path' : json.result},
                    async: false,
                    success: function (res) {
                        editor_out.setValue(res, 1);
                        editor_out.scrollToLine(editor_out.getSelectionRange().end.row, true, true);
                        editor_out.gotoLine(editor_out.getSelectionRange().end.row, 1, true);
                    }
                });
            } else if (json.status == 'error') {
                alert(json.info);
            }
        }
    });
}
</script>
 </body>
</html>
